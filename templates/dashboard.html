{% extends "base.html" %}

{% block title %}Dashboard - AI Development Quiz App{% endblock %}

{% block extra_css %}
<style>
    .quiz-card {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        border: 2px solid #e0e0e0;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 20px;
        transition: all 0.3s;
        cursor: pointer;
    }

    .quiz-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        border-color: #667eea;
    }

    .quiz-card-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 15px;
    }

    .quiz-icon {
        font-size: 3em;
    }

    .quiz-title {
        font-size: 1.5em;
        font-weight: bold;
        color: #667eea;
        margin: 0;
    }

    .quiz-description {
        color: #666;
        margin-bottom: 15px;
        line-height: 1.6;
    }

    .quiz-stats {
        display: flex;
        gap: 20px;
        margin-bottom: 15px;
        font-size: 0.9em;
    }

    .quiz-stat {
        color: #555;
    }

    .recent-activity-item {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .activity-info {
        flex: 1;
    }

    .activity-title {
        font-weight: 600;
        color: #333;
        margin-bottom: 5px;
    }

    .activity-meta {
        font-size: 0.9em;
        color: #666;
    }

    .activity-score {
        font-size: 1.2em;
        font-weight: bold;
        color: #667eea;
    }

    .no-activity {
        text-align: center;
        padding: 40px;
        color: #999;
        font-style: italic;
    }
</style>
{% endblock %}

{% block content %}
<h1>Welcome back, {{ user.username }}!</h1>
<p class="subtitle">Continue your AI development learning journey</p>

<div class="stats-grid" style="margin-bottom: 40px;">
    <div class="stat-card">
        <div class="stat-value">{{ stats.total_attempts }}</div>
        <div class="stat-label">Quizzes Taken</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ stats.avg_score }}%</div>
        <div class="stat-label">Average Score</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ stats.best_score }}%</div>
        <div class="stat-label">Best Score</div>
    </div>
</div>

<h2 style="margin-bottom: 25px;">Choose a Quiz</h2>

{% for quiz in quizzes %}
<div class="quiz-card" onclick="document.getElementById('quiz-form-{{ quiz.id }}').submit();">
    <div class="quiz-card-header">
        <div class="quiz-icon">
            {% if 'Agent' in quiz.category %}
            ü§ñ
            {% elif 'Prompt' in quiz.category %}
            ‚úçÔ∏è
            {% elif 'Model' in quiz.category %}
            üéØ
            {% else %}
            üìù
            {% endif %}
        </div>
        <div>
            <h3 class="quiz-title">{{ quiz.category }}</h3>
        </div>
    </div>

    <p class="quiz-description">{{ quiz.description }}</p>

    <div class="quiz-stats">
        <span class="quiz-stat">üìä {{ quiz.get_question_count() }} questions</span>
        {% if category_stats.get(quiz.id) and category_stats[quiz.id].attempt_count > 0 %}
        <span class="quiz-stat">üéØ Best: {{ category_stats[quiz.id].best_score }}%</span>
        <span class="quiz-stat">üîÑ Taken: {{ category_stats[quiz.id].attempt_count }} times</span>
        {% endif %}
    </div>

    <form id="quiz-form-{{ quiz.id }}" method="POST" action="{{ url_for('start_quiz') }}" style="margin: 0;">
        <input type="hidden" name="quiz_id" value="{{ quiz.id }}">
        <button type="submit" class="btn" style="width: 100%;">Start Quiz</button>
    </form>
</div>
{% endfor %}

<h2 style="margin-top: 50px; margin-bottom: 25px;">Recent Activity</h2>

{% if recent_attempts %}
    {% for attempt in recent_attempts %}
    <div class="recent-activity-item">
        <div class="activity-info">
            <div class="activity-title">{{ attempt.quiz.category }}</div>
            <div class="activity-meta">
                {{ attempt.get_formatted_date() }}
            </div>
        </div>
        <div class="activity-score">
            {{ attempt.score }}/{{ attempt.total_questions }} ({{ attempt.percentage|round(1) }}%)
        </div>
    </div>
    {% endfor %}
{% else %}
    <div class="no-activity">
        <p>No quiz attempts yet. Start your first quiz above!</p>
    </div>
{% endif %}

{% endblock %}
